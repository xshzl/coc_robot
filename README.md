# 部落冲突（国际服）自动化辅助工具

[![GitHub stars](https://img.shields.io/github/stars/qilishidai/coc_robot)](https://github.com/qilishidai/coc_robot/stargazers)
[![GitHub forks](https://img.shields.io/github/forks/qilishidai/coc_robot)](https://github.com/qilishidai/coc_robot/network)
[![License](https://img.shields.io/github/license/qilishidai/coc_robot)](https://github.com/qilishidai/coc_robot/blob/main/LICENSE)

`coc_robot` 是一个基于 Python 的《部落冲突》(国际服) 自动化辅助程序，采用先进的 YOLO 图像识别技术和模块化架构设计，实现智能化的游戏操作自动化。

> # ⚠️ 重要声明与风险警告
>
> ## 本项目性质
>
> **本项目仅为技术研究和学习交流目的而创建**，用于演示：
> - 图像识别技术（YOLO、OCR）的应用
> - Python自动化脚本的开发方法
> - 人机交互模拟的技术实现
>
> ## 严重警告
>
> 1. **禁止用于实际游戏** - 使用本工具操作真实游戏账号**严重违反**游戏服务条款
> 2. **账号封禁风险** - 使用自动化工具可能导致账号被**永久封禁**
> 3. **法律风险** - 在某些司法管辖区，使用游戏外挂可能违反相关法律法规
> 4. **个人数据风险** - 本工具需要控制设备权限，存在数据安全隐患
> 5. **无任何担保** - 作者**不保证**代码安全性、稳定性或任何功能
>
> ## 免责声明
>
> - ❌ 作者**不承担**因使用本项目导致的任何直接或间接损失
> - ❌ 作者**不承担**因账号封禁、数据丢失等产生的任何责任
> - ❌ 作者**不承担**因违反法律法规产生的任何法律后果
> - ❌ 作者**不提供**任何技术支持或使用建议
> - ❌ 本项目**不隶属于**、**不代表**、**未经授权**任何游戏公司
>
> ## 用户责任
>
> **下载、使用或传播本项目即表示您已完全理解并同意：**
>
> 1. 您已年满18周岁，具有完全民事行为能力
> 2. 您将**仅用于学习研究**，不用于任何实际游戏账号
> 3. 您**自行承担**使用本工具的一切风险和后果
> 4. 您**不会**将本工具用于任何商业用途或非法用途
> 5. 您理解使用游戏外挂可能违反当地法律和游戏条款
>
> **如不同意以上条款，请立即停止使用并删除本项目**
>
> ## 版权声明
>
> - 《部落冲突》及相关商标归 **Supercell Oy** 所有
> - 本项目与 Supercell 公司**没有任何**关联、授权或赞助关系
> - 本项目遵循 [Supercell 粉丝内容政策](https://www.supercell.com/en/fan-content-policy)，仅作为粉丝创作内容

---

## ✨ 核心特性

### 🎯 智能识别
- ✅ 基于 **YOLO v5** 深度学习模型，识别游戏内建筑和资源
- ✅ **OCR 文字识别**，准确读取资源数值
- ✅ **模板匹配技术**，快速定位UI元素

> ⚠️ **注意**：项目自带的YOLO模型仅支持检测 4 种资源建筑（金矿、金库、圣水采集器、圣水瓶）。检测其他目标需要自己训练模型，详见 [YOLO检测器完整指南](docs/开发指南/06-YOLO检测器完整指南.md)。

### 🤖 自动化操作
- ✅ **主世界打鱼** - 自动搜索、进攻、收资源
- ✅ **夜世界打鱼** - 支持夜世界自动对战
- ✅ **天鹰火炮成就** - 自动检测天鹰火炮，雷电法术精准攻击
- ✅ **自动升级** - 智能升级城墙、建筑、英雄
- ✅ **战宠升级** - 自动升级指定战宠（莱希、闪枭、猛蜥等11种）
- ✅ **法术释放** - 自动识别并释放各类法术

### 💼 多账号管理
- ✅ **多模拟器支持** - 同时管理多个账号
- ✅ **独立配置** - 每个账号可设置不同策略
- ✅ **UI界面管理** - 可视化控制所有机器人

### ⚡ 技术特性
- ✅ **定时任务** - 支持计划任务配置
- ✅ **命令行支持** - 支持脚本化调用
- ✅ **状态监控** - 自动检测程序状态并重启
- ✅ **操作模拟** - 基于贝塞尔曲线的鼠标轨迹模拟

---

## 📚 文档导航

### ⚠️ 使用前必读

- [📜 免责声明](docs/法律声明/免责声明.md)
- [⚖️ 风险分析](docs/法律声明/风险分析.md)

### 用户指南

- [🚀 快速开始](docs/用户指南/快速开始.md) - 5分钟上手
- [📅 自动启动功能](docs/用户指南/自动启动功能.md) - 定时自动启动
- [💻 命令行使用](docs/用户指南/命令行使用.md) - 高级用户
- [❓ 常见问题](docs/用户指南/常见问题.md) - FAQ

### 开发文档

- [📖 文档索引](docs/README.md) - 完整文档目录
- [🎨 项目设计思路](docs/开发指南/00-项目设计思路.md) - 理解架构
- [🔧 快速开始（开发）](docs/开发指南/01-快速开始.md) - 开发环境搭建
- [📝 开发第一个任务](docs/开发指南/02-开发第一个任务.md) - 手把手教学
- [🎯 YOLO检测器指南](docs/开发指南/06-YOLO检测器完整指南.md) - 训练自己的模型

---

## 🚀 快速开始

### 前置要求

| 软件 | 版本 | 说明 |
|------|------|------|
| Windows | 10/11 | 操作系统 |
| Python | 3.10.9 | **推荐此版本**，其他版本可能依赖出错 |
| 雷电模拟器 | 最新版 | 用于运行游戏 |
| Git | 最新版 | 用于克隆代码 |

### 第一步：环境准备

#### 1.1 Windows 显示设置
- 打开 **Windows 设置 → 系统 → 显示**
- 确保 **缩放** 设置为 **100%**（必须）

#### 1.2 安装 Python
1. 前往 [Python 官网](https://www.python.org/downloads/release/python-3109/) 下载 **Python 3.10.9**
2. 安装时 **务必勾选** "Add Python to PATH"
3. 完成安装后，打开命令行验证：
   ```bash
   python --version
   ```
   应显示：`Python 3.10.9`

#### 1.3 安装 Git
1. 前往 [Git 官网](https://git-scm.com/) 下载安装包
2. 安装过程全部默认，一路"下一步"即可

### 第二步：安装雷电模拟器

1. 下载并安装 [雷电模拟器](https://www.ldmnq.com/)
2. 启动模拟器，进行以下设置：
   - **分辨率**：`800 × 600`
   - **DPI**：`160`
   - **性能设置**：根据电脑配置选择（建议2核4G内存）
3. 关闭所有滤镜插件（如 MSI Afterburner、NVIDIA 滤镜等）

### 第三步：安装游戏

1. 在雷电模拟器内安装 [《部落冲突》国际服](https://clashpost.com/apk)
2. 登录你的账号
3. 进入主世界，保持默认皮肤（不要使用特殊皮肤，影响识别）

### 第四步：配置兵种和法术

#### 支持的兵种

<details>
<summary><b>点击展开查看所有支持的兵种</b></summary>

**普通兵种**
> 野蛮人、弓箭手、巨人、哥布林、气球兵、法师、炸弹人、飞龙、皮卡超人、矿工、飞龙宝宝、野猪骑士、女巫、天使、天狗、雷龙、大雪怪、龙骑士、根蔓骑士、蓝胖、石头人、苍蝇、戈仑冰人

**超级兵种**
> 超级野蛮人、超级飞龙、超级哥布林

**活动/赛季兵种**
> 扫帚女巫、蛮羊骑士、寒冰亡灵、收债哥布林

**空中攻城武器**
> 攻城气球

**英雄**
> 野蛮人之王、弓箭女皇、大守护者、飞盾战神、亡灵王子

</details>

#### 支持的法术

**自动释放法术**（在所有兵种下完后循环释放）
- 镜像法术 - 在最后下兵位置释放
- 图腾法术、地震法术、蝙蝠法术、闪电法术、骷髅法术 - 在预设坐标随机释放

> 💡 **提示**：在游戏训练营中配置你想要的兵种和法术组合，程序会自动识别并使用。

### 第五步：下载并安装辅助程序

打开命令提示符（Win + R，输入 `cmd`），执行以下命令：

```bash
# 1. 克隆项目（如果网络慢，可以使用Git加速服务）
git clone https://github.com/qilishidai/coc_robot.git

# 2. 进入项目目录
cd coc_robot

# 3. 安装依赖（使用清华镜像加速）
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 4. 启动程序
python UI入口.py
```

### 第六步：配置并启动机器人

1. 程序会弹出UI界面
2. 点击右侧 **"配置管理"** 选项卡
3. 填写机器人配置：
   - **机器人标识**：唯一名称，如 `主号`、`小号1`
   - **模拟器索引**：雷电多开器中的序号（第一个是0）
   - **服务器**：选择 `国际服`
   - **最小资源**：搜索村庄时的最低资源要求
   - **其他参数**：根据需要调整
4. 点击 **"创建新机器人"** 保存配置
5. 在左侧列表中选择刚创建的机器人
6. 点击 **"启动"** 按钮开始自动化

---

## 🔧 虚拟环境配置

### 什么是虚拟环境？

虚拟环境是一个**独立的 Python 运行环境**，它的优势：

✅ **环境隔离** - 不同项目的依赖互不干扰
✅ **版本管理** - 每个项目可使用不同版本的库
✅ **便于维护** - 删除项目时直接删除文件夹即可
✅ **避免冲突** - 不会污染系统Python环境

### 是否需要使用虚拟环境？

| 场景 | 是否需要 |
|------|----------|
| 只运行这一个Python项目 | ❌ 不需要（直接安装即可） |
| 电脑上有多个Python项目 | ✅ 强烈推荐 |
| 担心依赖冲突 | ✅ 推荐 |
| 想要更专业的环境管理 | ✅ 推荐 |

### 创建和使用虚拟环境

#### Windows 系统

```bash
# 1. 进入项目目录
cd coc_robot

# 2. 创建虚拟环境（只需要做一次）
python -m venv .venv

# 3. 激活虚拟环境
.venv\Scripts\activate

# 4. 看到命令行前面出现 (.venv) 就表示成功了
# (.venv) C:\Users\YourName\coc_robot>

# 5. 安装依赖（在虚拟环境中）
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 6. 启动程序
python UI入口.py

# 7. 退出虚拟环境（不需要程序时）
deactivate
```

#### Linux / macOS 系统

```bash
# 1. 创建虚拟环境
python3 -m venv .venv

# 2. 激活虚拟环境
source .venv/bin/activate

# 3-6. 后续步骤与Windows相同

# 7. 退出虚拟环境
deactivate
```

### 快捷启动（已创建虚拟环境的情况下）

如果你已经创建了虚拟环境，后续启动更简单：

**Windows**：双击 `激活虚拟环境并启动辅助.bat`（项目自带）

或者手动执行：
```bash
cd coc_robot
.venv\Scripts\activate
python UI入口.py
```

### 常见问题

<details>
<summary><b>Q: 激活虚拟环境时提示"禁止运行脚本"？</b></summary>

**Windows PowerShell** 的安全策略限制，解决方法：

```powershell
# 以管理员身份运行 PowerShell，执行：
Set-ExecutionPolicy RemoteSigned

# 然后再激活虚拟环境
.venv\Scripts\activate
```

或者使用 **CMD命令提示符** 代替 PowerShell。
</details>

<details>
<summary><b>Q: 如何确认我在虚拟环境中？</b></summary>

命令行前面会显示 `(.venv)`：

```
(.venv) C:\Users\YourName\coc_robot>
```

使用 `where python` (Windows) 或 `which python` (Linux/Mac) 查看Python路径，应该指向项目下的 `.venv` 文件夹。
</details>

<details>
<summary><b>Q: 如何删除虚拟环境？</b></summary>

直接删除 `.venv` 文件夹即可：

```bash
# Windows
rmdir /s .venv

# Linux/Mac
rm -rf .venv
```

然后重新创建即可。
</details>

---

## ⚙️ 配置说明

### 核心参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| 机器人标识 | 文本 | `robot_` | 机器人唯一标识，用于区分多个账号 |
| 模拟器索引 | 数字 | `0` | 雷电多开器中的序号（从0开始） |
| 服务器 | 选择 | `国际服` | 游戏服务器（目前仅支持国际服） |
| 最小资源 | 数字 | `200000` | 进攻时要求敌方资源总量的最小值 |
| 进攻资源边缘靠近比例下限 | 小数 | `0.6` | 资源建筑靠近地图边缘的比例（0-1） |
| 是否开启刷墙 | 开关 | `关闭` | 是否使用多余资源升级城墙 |
| 刷墙起始金币 | 数字 | `200000` | 金币超过此值时触发刷墙 |
| 刷墙起始圣水 | 数字 | `200000` | 圣水超过此值时触发刷墙 |
| 辅助运行模式 | 选择 | `只打主世界` | 选择打鱼模式：主世界/夜世界/两者 |
| 欲升级的英雄 | 多选 | 无 | 选择想要自动升级的英雄 |
| 要自动升级的战宠 | 选择 | 无 | 选择要升级的战宠（支持11种战宠） |
| 战宠升级检查间隔 | 数字 | `0` | 检查战宠升级的时间间隔（小时） |

### 推荐配置

**低本玩家（1-7本）**
```
最小资源：100000
边缘比例：0.0（打所有资源）
```

**中本玩家（8-11本）**
```
最小资源：200000
边缘比例：0.3（优先外围）
```

**高本玩家（12本+）**
```
最小资源：300000-500000
边缘比例：0.6（只打外围采集器）
```

---

## 📅 自动启动功能

### 方式一：UI界面设置（推荐 ⭐）

**最简单**的定时自动启动方式，无需了解命令行和计划任务！

1. 打开 `UI入口.py`
2. 点击右侧 **"自动启动"** 选项卡
3. 勾选机器人的 **"启用自动启动"**
4. 设置启动时间（如 `09:00`）
5. 点击 **"应用"** 按钮

✅ 系统会自动创建Windows计划任务和启动脚本
✅ 每天到设定时间自动启动机器人
✅ 无需手动操作

**详细说明**：[📅 自动启动功能说明](docs/自动启动功能说明.md)

### 方式二：命令行启动（高级用户）

如果你熟悉命令行，也可以使用传统方式手动编写启动脚本。

**详细说明**：[💻 命令行使用指南](docs/命令行使用指南.md)

---

## 🔄 更新程序

### 方式一：使用 Git 更新（推荐）

```bash
# 在项目目录打开命令行
cd coc_robot

# 拉取最新代码
git pull
```

### 方式二：重新下载

1. 删除旧的 `coc_robot` 文件夹
2. 重新执行 `git clone` 命令
3. 重新安装依赖 `pip install -r requirements.txt`

> 💡 **注意**：更新前建议备份你的配置数据库文件（`数据库/任务数据库.db`）

---

## ❓ 常见问题

<details>
<summary><b>Q: 程序无法识别兵种/建筑？</b></summary>

1. 确认模拟器分辨率为 `800×600`，DPI为 `160`
2. 确认Windows缩放为 `100%`
3. 关闭所有滤镜插件
4. 使用游戏默认皮肤，不要使用特殊背景
</details>

<details>
<summary><b>Q: 程序启动后一直卡在某个状态？</b></summary>

1. 查看日志输出，确认具体卡在哪一步
2. 手动检查游戏是否正常运行
3. 尝试重启模拟器
4. 检查程序是否有权限访问模拟器（建议都用普通用户身份运行）
</details>

<details>
<summary><b>Q: 多账号如何配置？</b></summary>

1. 使用雷电多开器创建多个模拟器实例
2. 每个实例登录不同账号
3. 在UI中为每个账号创建独立的机器人配置
4. 模拟器索引对应雷电多开器中的序号（从0开始）
</details>

<details>
<summary><b>Q: 夜世界如何使用？</b></summary>

1. 在游戏中切换到夜世界
2. 在配置中选择 `只打夜世界` 或 `先打满主世界再打夜世界`
3. 夜世界目前仅支持单一兵种配置
</details>

<details>
<summary><b>Q: 战宠升级功能如何使用？</b></summary>

1. 在配置面板中选择 **"要自动升级的战宠"**
2. 支持的战宠：莱希、闪枭、大耗、独角、冰牙、地兽、猛蜥、凤凰、灵狐、愤怒水母、阿啾
3. 程序会自动检测：资源是否充足、战宠是否已满级、是否有宠物正在升级
4. 可设置 **"战宠升级检查间隔"** 避免频繁检测（单位：小时）
5. 留空则不启用战宠自动升级
</details>

<details>
<summary><b>Q: 程序的操作模拟是如何实现的？</b></summary>

本程序采用多种技术模拟人类操作行为，用于技术研究：

- ✅ 已实现：随机延时、贝塞尔曲线移动、随机点击偏移
- 📚 这些技术可用于学习自动化测试、UI自动化等领域
</details>

---

## 🛠️ 开发者文档

如果你想修改代码或开发新功能：

- [📖 完整文档索引](docs/README.md) - 所有开发文档
- [🎨 项目设计思路](docs/开发指南/00-项目设计思路.md) - 核心架构设计
- [📝 开发第一个任务](docs/开发指南/02-开发第一个任务.md) - 手把手教学
- [🎯 YOLO检测器完整指南](docs/开发指南/06-YOLO检测器完整指南.md) - 训练自己的模型

### 项目架构

项目采用三层模块化设计：

```
┌─────────────────────────────────────┐
│           监控中心                   │  ← 多机器人管理、健康检查
├─────────────────────────────────────┤
│      自动化机器人 (多个实例)          │  ← 任务调度、状态管理
├─────────────────────────────────────┤
│           任务流程                   │  ← 具体任务实现
├─────────────────────────────────────┤
│    底层接口 (识图/OCR/YOLO/模拟器)    │  ← 线程安全、可单元测试
└─────────────────────────────────────┘
```

### 核心目录

| 目录 | 说明 |
|------|------|
| `任务流程/` | 所有自动化任务的实现 |
| `模块/检测/` | YOLO、OCR、模板匹配引擎 |
| `核心/` | 屏幕截图、鼠标键盘操作 |
| `线程/` | 机器人线程管理 |
| `界面/` | UI界面组件 |
| `数据库/` | 配置和日志存储 |
---

## 📜 完整免责声明

### 再次严肃提醒

**本项目代码仅供技术学习和研究使用，作者强烈反对将其用于任何实际游戏环境。**

### 风险列表

使用本工具可能面临以下风险，**用户需自行承担全部后果**：

1. **账号风险**
   - 游戏账号被永久封禁
   - 账号数据被清空
   - 无法恢复任何游戏进度

2. **法律风险**
   - 可能违反《中华人民共和国刑法》第285条（非法侵入计算机信息系统罪）
   - 可能违反《计算机软件保护条例》
   - 可能违反游戏所在国家/地区的相关法律
   - 可能构成不正当竞争行为

3. **隐私与安全风险**
   - 工具需要读取屏幕内容，可能泄露个人信息
   - 工具需要模拟操作，可能被恶意利用
   - 第三方修改版本可能包含恶意代码

4. **财务风险**
   - 账号被封禁导致的游戏内购买损失
   - 可能面临游戏公司的民事索赔
   - 可能面临刑事罚款

### 作者声明

1. **完全免责**：作者对本项目的任何使用后果**不承担任何责任**
2. **无技术支持**：作者**不提供**任何使用指导或技术支持
3. **不鼓励使用**：作者**强烈建议**不要使用本工具操作真实账号
4. **教育目的**：本项目仅为展示技术实现，不构成任何使用建议
5. **随时删除**：作者保留随时删除本项目的权利

### 游戏公司权益

- 本项目**尊重** Supercell 公司的知识产权
- 本项目**不修改**游戏客户端或服务器
- 本项目**不破解**任何加密或保护机制
- 本项目**遵循** [Supercell 粉丝内容政策](https://www.supercell.com/en/fan-content-policy)
- 如 Supercell 公司要求删除，作者将**立即删除**本项目

### 用户最终确认

**通过访问、下载、克隆、使用或以任何方式与本项目交互，您确认：**

- ✅ 您已完整阅读并理解本声明
- ✅ 您已年满18周岁或在监护人同意下使用
- ✅ 您仅将本项目用于学习研究目的
- ✅ 您自愿承担使用本项目的一切风险
- ✅ 您放弃对作者的任何索赔权利

**如不同意，请立即离开并删除所有相关文件。**

---

## ⭐ Star History

如果这个项目对你有帮助，不要点 Star ⭐，也不要传播

[![Star History Chart](https://api.star-history.com/svg?repos=qilishidai/coc_robot&type=Date)](https://star-history.com/#qilishidai/coc_robot&Date)

---

## 📞 联系方式

- 问题反馈：[GitHub Issues](https://github.com/qilishidai/coc_robot/issues)
- 更新日志：[Commits](https://github.com/qilishidai/coc_robot/commits/main)

---

<div align="center">

**本项目仅供技术学习与研究，请勿用于实际游戏环境**

*本项目遵循 MIT 开源协议*

</div>
