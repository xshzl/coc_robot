"""
用户协议模块 - 用户协议显示和管理功能
"""
import tkinter as tk
from tkinter import ttk, scrolledtext

# 用户协议文本
协议文本 = """
用户协议与免责声明


版本：1.0

请您在使用本软件前仔细阅读并充分理解本协议的全部内容。如您不同意本协议的任何条款，请立即停止使用本软件。您继续使用本软件即视为您已阅读、理解并同意受本协议约束。


第一条 定义与解释

1.1 "本软件"指您当前正在使用的计算机程序及其相关文档、配置文件。

1.2 "开发者"指本软件的原始作者及贡献者。

1.3 "您"或"用户"指下载、安装、访问或以任何方式使用本软件的个人或实体。

1.4 "第三方游戏"指与本软件可能产生交互的任何游戏软件，包括但不限于《部落冲突》（Clash of Clans）。


第二条 软件性质与用途限制

2.1 本软件是一个开源技术演示项目，其唯一目的是供用户学习和研究以下技术领域：
    (a) Python编程语言及其应用；
    (b) 计算机视觉与图像识别技术；
    (c) 软件自动化与脚本开发；
    (d) 软件架构设计模式。

2.2 本软件不得用于以下任何目的：
    (a) 操作任何真实的游戏账号；
    (b) 获取任何不正当的游戏优势；
    (c) 任何商业目的或营利活动；
    (d) 任何违反适用法律法规的行为。

2.3 本软件与Supercell Oy公司及其产品没有任何关联。《部落冲突》及相关商标是Supercell Oy公司的财产。


第三条 知识产权声明

3.1 本软件的源代码按其开源许可证条款提供。

3.2 本软件中可能包含的任何第三方游戏的截图、图标或其他素材，其知识产权归原权利人所有，在本软件中的使用仅限于技术演示和教育目的。

3.3 如任何权利人认为本软件侵犯其合法权益，请通过项目页面联系开发者，开发者将及时处理。


第四条 风险告知

4.1 法律风险。使用本软件或类似工具操作真实游戏账号可能构成：
    (a) 违反《中华人民共和国刑法》第二百八十五条（非法侵入计算机信息系统罪）或第二百八十六条（破坏计算机信息系统罪）；
    (b) 违反《计算机软件保护条例》关于软件保护的规定；
    (c) 违反《中华人民共和国反不正当竞争法》的相关规定；
    (d) 违反其他国家或地区的计算机犯罪相关法律。

4.2 游戏账号风险。将本软件用于真实游戏环境可能导致：
    (a) 游戏账号被永久封禁且无法恢复；
    (b) 游戏内虚拟财产和进度全部丢失；
    (c) 相关设备或网络地址被列入黑名单。

4.3 技术风险。本软件可能存在缺陷，包括但不限于：
    (a) 程序错误导致系统不稳定；
    (b) 资源占用过高影响设备性能；
    (c) 与其他软件产生兼容性问题。

4.4 安全风险。从非官方渠道获取的本软件副本可能被篡改并包含恶意代码。


第五条 免责声明

5.1 本软件按"现状"和"可用"基础提供，不附带任何形式的明示或暗示保证，包括但不限于对适销性、特定用途适用性、不侵权的保证。

5.2 在适用法律允许的最大范围内，开发者明确声明不对以下事项承担任何责任：
    (a) 因使用或无法使用本软件而导致的任何直接、间接、附带、特殊、惩罚性或后果性损害；
    (b) 游戏账号被封禁、限制或删除；
    (c) 游戏内虚拟财产或进度的损失；
    (d) 设备损坏、数据丢失或系统故障；
    (e) 因违法行为而产生的罚款、赔偿或刑事责任；
    (f) 任何第三方对用户提起的索赔。

5.3 开发者不提供任何技术支持或使用指导，也不对本软件的持续可用性作出任何承诺。


第六条 用户声明与保证

6.1 通过使用本软件，您声明并保证：
    (a) 您已年满18周岁或已达到您所在司法管辖区的法定成年年龄；
    (b) 您具有完全的民事行为能力签署并履行本协议；
    (c) 您将仅将本软件用于合法的学习和研究目的；
    (d) 您已充分理解使用本软件可能带来的所有风险；
    (e) 您自愿承担因使用本软件而可能产生的一切后果。

6.2 您同意就因您违反本协议或适用法律而给开发者造成的任何损失、损害、责任、成本和费用（包括合理的律师费）向开发者进行赔偿并使其免受损害。


第七条 隐私

7.1 本软件在设计上不收集、传输或存储任何用户个人信息。

7.2 本软件生成的所有配置和日志数据均存储在用户本地设备上。

7.3 本软件不包含广告、用户追踪或远程数据收集功能。


第八条 协议的变更与终止

8.1 开发者保留随时修改本协议的权利。修改后的协议将在软件更新时生效。

8.2 开发者保留随时停止维护或删除本软件的权利，届时无需另行通知。

8.3 如您违反本协议的任何条款，您使用本软件的权利将自动终止。


第九条 一般条款

9.1 本协议受中华人民共和国法律管辖并按其解释。

9.2 因本协议引起的或与本协议有关的任何争议，双方应首先通过友好协商解决。协商不成的，任何一方均可向开发者所在地有管辖权的人民法院提起诉讼。

9.3 本协议的任何条款被认定为无效或不可执行的，不影响其他条款的效力。

9.4 开发者未行使或延迟行使本协议项下的任何权利，不构成对该权利的放弃。

9.5 本协议构成双方就本软件使用事宜达成的完整协议，取代此前的任何口头或书面协议。


如果您不同意本协议的任何条款，请立即停止使用本软件。

点击"同意并继续"即表示您确认已阅读、理解并同意接受本协议的全部条款。
"""


def 显示用户协议窗口() -> bool:
    """显示用户协议窗口，返回是否同意"""

    协议窗口 = tk.Tk()
    协议窗口.title("用户协议")
    协议窗口.geometry("650x550")
    # 居中显示
    屏幕宽度 = 协议窗口.winfo_screenwidth()
    屏幕高度 = 协议窗口.winfo_screenheight()
    x = (屏幕宽度 - 650) // 2
    y = (屏幕高度 - 550) // 2
    协议窗口.geometry(f"650x550+{x}+{y}")
    # 禁止调整大小
    协议窗口.resizable(False, False)

    用户已同意 = [False]  # 使用列表以便在闭包中修改

    # 标题
    标题 = ttk.Label(协议窗口, text="用户协议与免责声明", font=("", 14, "bold"))
    标题.pack(pady=10)

    # 协议文本区域 (ScrolledText)
    文本框 = scrolledtext.ScrolledText(协议窗口, wrap=tk.WORD, width=75, height=22)
    文本框.pack(padx=15, pady=5, fill=tk.BOTH, expand=True)
    文本框.insert(tk.END, 协议文本)
    文本框.config(state=tk.DISABLED)

    # 勾选框
    同意变量 = tk.BooleanVar(value=False)
    勾选框 = ttk.Checkbutton(协议窗口, text="我已阅读并同意以上协议", variable=同意变量)
    勾选框.pack(pady=10)

    # 按钮框架
    按钮框架 = ttk.Frame(协议窗口)
    按钮框架.pack(pady=10)

    # 同意按钮（初始禁用）
    同意按钮 = ttk.Button(按钮框架, text="同意并继续", state=tk.DISABLED)
    同意按钮.pack(side=tk.LEFT, padx=20)

    # 退出按钮
    退出按钮 = ttk.Button(按钮框架, text="退出程序", command=协议窗口.destroy)
    退出按钮.pack(side=tk.LEFT, padx=20)

    # 勾选框状态变化时启用/禁用按钮
    def 更新按钮状态(*args):
        同意按钮.config(state=tk.NORMAL if 同意变量.get() else tk.DISABLED)
    同意变量.trace_add("write", 更新按钮状态)

    # 同意按钮点击
    def 确认同意():
        用户已同意[0] = True
        协议窗口.destroy()
    同意按钮.config(command=确认同意)

    # 关闭窗口等同于拒绝
    协议窗口.protocol("WM_DELETE_WINDOW", 协议窗口.destroy)

    协议窗口.mainloop()
    return 用户已同意[0]


def 显示协议查看窗口(父窗口):
    """在菜单中查看用户协议内容（Toplevel窗口）"""
    协议窗口 = tk.Toplevel(父窗口)
    协议窗口.title("用户协议与免责声明")
    协议窗口.geometry("650x550")
    协议窗口.transient(父窗口)
    协议窗口.grab_set()

    # 居中显示
    屏幕宽度 = 协议窗口.winfo_screenwidth()
    屏幕高度 = 协议窗口.winfo_screenheight()
    x = (屏幕宽度 - 650) // 2
    y = (屏幕高度 - 550) // 2
    协议窗口.geometry(f"650x550+{x}+{y}")

    标题 = ttk.Label(协议窗口, text="用户协议与免责声明", font=("", 14, "bold"))
    标题.pack(pady=10)

    文本框 = scrolledtext.ScrolledText(协议窗口, wrap=tk.WORD, width=75, height=25)
    文本框.pack(padx=15, pady=5, fill=tk.BOTH, expand=True)
    文本框.insert(tk.END, 协议文本)
    文本框.config(state=tk.DISABLED)

    关闭按钮 = ttk.Button(协议窗口, text="关闭", command=协议窗口.destroy)
    关闭按钮.pack(pady=10)
